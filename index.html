<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://wcgrcntyencwkwwnuwyz.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndjZ3JjbnR5ZW5jd2t3d251d3l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MDM1NDksImV4cCI6MjA3ODQ3OTU0OX0.dKUY44Cc_D0I00h0ZbhCVmuIonqMlxcIPBhHUOK1YwM";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const loginForm = document.getElementById("loginForm");
  const mensagemEl = document.getElementById("mensagem");

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    mensagemEl.textContent = "Verificando...";

    let nome = document.getElementById("usuario").value.trim().toLowerCase();
    let senha = document.getElementById("senha").value.trim();

    console.log("Tentando login com:", { nome, senha });

    try {
      // Busca todos os operadores e faz match manual ignorando maiúsculas/minúsculas
      const { data: operadores, error } = await supabase
        .from("operadores")
        .select("*");

      if (error) throw error;

      const operador = operadores.find(op => op.nome.trim().toLowerCase() === nome && op.senha.trim() === senha);

      if (!operador) {
        mensagemEl.textContent = "Usuário ou senha incorretos!";
        return;
      }

      localStorage.setItem("operador_nome", operador.nome);
      window.location.href = "painel.html";

    } catch (err) {
      console.error(err);
      mensagemEl.textContent = "Erro de conexão com o servidor!";
    }
  });
</script>
